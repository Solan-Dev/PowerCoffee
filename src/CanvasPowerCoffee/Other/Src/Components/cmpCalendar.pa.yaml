# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
ComponentDefinitions:
  cmpCalendar:
    DefinitionType: CanvasComponent
    AccessAppScope: true
    CustomProperties:
      inDate:
        PropertyKind: Input
        DisplayName: inDate
        Description: A custom property
        DataType: DateAndTime
        Default: =Today()
      inEvents:
        PropertyKind: Input
        DisplayName: inEvents
        Description: A custom property
        DataType: Table
        Default: |+
          =Table(
              {EventDate:Date(2025,2,1),EventType:"AutomatedRelease",EventName:"Automated Release",EventDescription:"Event rgk jner go jj nerg;i jenrgk;jenrg oierfbokdnffb"},
              {EventDate:Date(2025,2,1),EventType:"DecisionEngine",EventName:"Decision Engine",EventDescription:"Event description"},
              {EventDate:Date(2025,2,1),EventType:"LeagueTable",EventName:"Event3",EventDescription:"Event description"},
              {EventDate:Date(2025,2,1),EventType:"FreeText",EventName:"Event4",EventDescription:"Event description"}
          )
      inMonth:
        PropertyKind: Input
        DisplayName: inMonth
        Description: A custom property
        DataType: Text
        Default: =Text(cmpCalendar.inDate,"mmmm yyyy")
      inValues:
        PropertyKind: Input
        DisplayName: inValues
        Description: A custom property
        DataType: Table
        Default: =Table({StartofWeek:"Monday"})
    Properties:
      Height: =App.DesignHeight
      Width: =App.DesignWidth
    Children:
      - conBase:
          Control: GroupContainer@1.4.0
          Variant: AutoLayout
          Properties:
            Height: =cmpCalendar.Height
            LayoutDirection: =LayoutDirection.Vertical
            Width: =cmpCalendar.Width
          Children:
            - conHeader:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutMinHeight: =10
                  LayoutMinWidth: =Parent.Width
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                  Width: =cmpCalendar.Width
                Children:
                  - conHeaderLeft:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Fill: =RGBA(255, 255, 255, 1)
                        LayoutMinHeight: =Parent.Height
                        LayoutMinWidth: =5
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
                      Children:
                        - txtMonth:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Center
                              Height: =64
                              PaddingBottom: =5
                              Text: |-
                                =$"{Text(varMonth,"mmmm")}
                                {Text(varMonth,"yyyy")}"
                              VerticalAlign: =VerticalAlign.Middle
                              Weight: ='TextCanvas.Weight'.Bold
                              Width: =149
                              X: =85
                        - btnNextMonth:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(0,0,0,0)
                              BorderThickness: =1
                              Color: =RGBA(0,0,0,1)
                              DisabledBorderColor: =RGBA(0,0,0,0)
                              Fill: =RGBA(0,0,0,0)
                              FocusedBorderColor: =RGBA(0,0,0,0)
                              FocusedBorderThickness: =0
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height - (Self.Y * 2)
                              HoverBorderColor: =RGBA(0,0,0,1)
                              HoverColor: =RGBA(0,0,0,1)
                              HoverFill: =RGBA(240, 240, 240, 0.8)
                              OnSelect: |-
                                =Set(varMonth,
                                    Date(
                                    Year(varMonth),
                                    Month(varMonth)+1,
                                    1
                                    )
                                )
                              PressedBorderColor: =RGBA(0,0,0,0)
                              PressedColor: =RGBA(0,0,0,0)
                              PressedFill: =RGBA(0,0,0,0)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =20
                              Text: =">"
                              Width: =32
                              X: =234
                              Y: =8
                        - btnPreviousMonth:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(0,0,0,0)
                              BorderThickness: =1
                              Color: =RGBA(0,0,0,1)
                              DisabledBorderColor: =RGBA(0,0,0,0)
                              Fill: =RGBA(0,0,0,0)
                              FocusedBorderColor: =RGBA(0,0,0,0)
                              FocusedBorderThickness: =0
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height - (Self.Y * 2)
                              HoverBorderColor: =RGBA(0,0,0,1)
                              HoverColor: =RGBA(0,0,0,1)
                              HoverFill: =RGBA(240, 240, 240, 0.8)
                              OnSelect: |-
                                =Set(varMonth,
                                    Date(
                                    Year(varMonth),
                                    Month(varMonth)-1,
                                    1
                                    )
                                )
                              PressedBorderColor: =RGBA(0,0,0,0)
                              PressedColor: =RGBA(0,0,0,0)
                              PressedFill: =RGBA(0,0,0,0)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =20
                              Text: ="<"
                              Width: =32
                              X: =53
                              Y: =8
                        - btnToday:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(0,0,0,1)
                              BorderThickness: =1
                              Color: =RGBA(0,0,0,1)
                              DisabledBorderColor: =RGBA(0,0,0,0)
                              Fill: =RGBA(0,0,0,0)
                              FocusedBorderColor: =RGBA(0,0,0,0)
                              FocusedBorderThickness: =0
                              Font: =Font.'Open Sans'
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height - (Self.Y * 2)
                              HoverBorderColor: =RGBA(0,0,0,1)
                              HoverColor: =RGBA(0,0,0,1)
                              HoverFill: =RGBA(240, 240, 240, 0.8)
                              OnSelect: |-
                                =Set(varMonth,
                                    Date(
                                    Year(Today()),
                                    Month(Today()),
                                    1
                                    )
                                )
                              PressedBorderColor: =RGBA(0,0,0,0)
                              PressedColor: =RGBA(0,0,0,0)
                              PressedFill: =RGBA(0,0,0,0)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Size: =10
                              Text: ="Today"
                              Width: =64
                              X: =292
                              Y: =16
                  - conHeaderRight:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        DropShadow: =DropShadow.None
                        Fill: =RGBA(255, 255, 255, 1)
                        LayoutMinHeight: =Parent.Height
                        LayoutMinWidth: =5
                        RadiusBottomLeft: =0
                        RadiusBottomRight: =0
                        RadiusTopLeft: =0
                        RadiusTopRight: =0
            - conCalendar:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  FillPortions: =11
                  LayoutDirection: =LayoutDirection.Vertical
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                  Width: =cmpCalendar.Width
                Children:
                  - galHeader:
                      Control: Gallery@2.15.0
                      Variant: Horizontal
                      Properties:
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Height: =45
                        Items: |-
                          =ForAll(
                              Sequence(7),
                              cmpCalendar.inDate
                              +Value-Weekday(cmpCalendar.inDate, 
                                  Switch(First(cmpCalendar.inValues).StartofWeek,
                                      "Monday",
                                      StartOfWeek.Monday,
                                      "Tuesday",
                                      StartOfWeek.Tuesday,
                                      "Wednesday",
                                      StartOfWeek.Wednesday,
                                      "Thursday",
                                      StartOfWeek.Thursday,
                                      "Friday",
                                      StartOfWeek.Friday,
                                      "Saturday",
                                      StartOfWeek.Saturday,
                                      "Sunday",
                                      StartOfWeek.Sunday
                                      ))
                          )
                        LayoutMinHeight: =10
                        LoadingSpinner: =LoadingSpinner.None
                        TemplatePadding: =galCalendarDays.TemplatePadding
                        TemplateSize: =galCalendarDays.TemplateWidth
                        Width: =galCalendarDays.Width
                        X: =40
                        Y: =103
                      Children:
                        - txtDay:
                            Control: Text@0.0.51
                            Properties:
                              Align: ='TextCanvas.Align'.Start
                              Height: =Parent.TemplateHeight
                              Text: =Text(ThisItem.Value,"dddd")
                              VerticalAlign: =VerticalAlign.Bottom
                              Width: =Parent.TemplateWidth
                  - galCalendarDays:
                      Control: Gallery@2.15.0
                      Variant: Vertical
                      Properties:
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Fill: =RGBA(245,245,245,1)
                        FillPortions: =22
                        Items: |+
                          =ForAll(
                              Sequence(42),
                              varMonth
                              +Value-Weekday(varMonth, 
                                  Switch(First(cmpCalendar.inValues).StartofWeek,
                                      "Monday",
                                      StartOfWeek.Monday,
                                      "Tuesday",
                                      StartOfWeek.Tuesday,
                                      "Wednesday",
                                      StartOfWeek.Wednesday,
                                      "Thursday",
                                      StartOfWeek.Thursday,
                                      "Friday",
                                      StartOfWeek.Friday,
                                      "Saturday",
                                      StartOfWeek.Saturday,
                                      "Sunday",
                                      StartOfWeek.Sunday
                                      ))
                          )

                        LayoutMinHeight: =60
                        LoadingSpinner: =LoadingSpinner.None
                        ShowScrollbar: =false
                        TemplateFill: =If(ThisItem.Value=Today(),RGBA(227, 240, 250, 1),RGBA(255,255,255,1))
                        TemplatePadding: =2
                        TemplateSize: =(galCalendarDays.Height - (galCalendarDays.TemplatePadding*6))/6
                        Width: =Parent.Width
                        WrapCount: =7
                        X: =40
                        Y: =188
                      Children:
                        - galEvents:
                            Control: Gallery@2.15.0
                            Variant: Vertical
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Height: =Parent.TemplateHeight - Self.Y
                              Items: =Filter(cmpCalendar.inEvents,EventDate=ThisItem.Value)
                              LoadingSpinner: =LoadingSpinner.None
                              ShowScrollbar: =false
                              TemplatePadding: =1
                              TemplateSize: =Self.Height * 0.20
                              Width: =Parent.TemplateWidth
                              Y: =txtDayDate.Y + txtDayDate.Height
                            Children:
                              - Image2:
                                  Control: Image@2.2.3
                                  Properties:
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Height: =Parent.TemplateHeight
                                    Image: |-
                                      ="data:image/svg+xml;utf8," & EncodeUrl(
                                          $"<svg width='{Self.Width}' height='{Self.Height}' viewBox='0 0 {Self.Width} {Self.Height}' xmlns='http://www.w3.org/2000/svg'>
                                              <defs>
                                                  <linearGradient id='AutomatedRelease' x1='0%' y1='0%' x2='100%' y2='0%' gradientUnits='userSpaceOnUse'>
                                                      <stop offset='0%' stop-color='#FF0F00'/>
                                                      <stop offset='100%' stop-color='#FF7A00'/>
                                                  </linearGradient>
                                                  <linearGradient id='DecisionEngine' x1='0%' y1='0%' x2='100%' y2='0%' gradientUnits='userSpaceOnUse'>
                                                      <stop offset='0%' stop-color='#0057FF'/>
                                                      <stop offset='100%' stop-color='#A6DFFF'/>
                                                  </linearGradient>
                                                  <linearGradient id='LeagueTable' x1='0%' y1='0%' x2='100%' y2='0%' gradientUnits='userSpaceOnUse'>
                                                      <stop offset='0%' stop-color='#ECEAE6'/>
                                                      <stop offset='100%' stop-color='#ECEAE6'/>
                                                  </linearGradient>
                                                  <linearGradient id='FreeText' x1='0%' y1='0%' x2='100%' y2='0%' gradientUnits='userSpaceOnUse'>
                                                      <stop offset='0%' stop-color='#FFFFFF'/>
                                                      <stop offset='100%' stop-color='#FFFFFF'/>
                                                  </linearGradient>
                                              </defs>
                                              <rect width='{Self.Width}' height='{Self.Height}' fill='url(#{Switch(ThisItem.EventType,"AutomatedRelease","AutomatedRelease","DecisionEngine","DecisionEngine","LeagueTable","LeagueTable","FreeText","FreeText")})' />
                                          </svg>"
                                      )
                                    OnSelect: =Select(Parent)
                                    RadiusBottomLeft: =7
                                    RadiusBottomRight: =7
                                    RadiusTopLeft: =7
                                    RadiusTopRight: =7
                                    Width: =Parent.TemplateWidth-Self.X*2
                                    X: |+
                                      =0
                                    Y: |+
                                      =0
                              - txtEvent:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =Parent.TemplateHeight
                                    PaddingBottom: =0
                                    PaddingLeft: =5
                                    Size: =10
                                    Text: |+
                                      =Left(ThisItem.EventName, RoundDown(Self.Width / 7, 0)) & If(Len(ThisItem.EventName) > RoundDown(Self.Width / 7, 0), "...", "") 
                                    VerticalAlign: =VerticalAlign.Top
                                    Width: =Parent.TemplateWidth*0.75
                                    Y: |+
                                      =0
                              - txtTime:
                                  Control: Text@0.0.51
                                  Properties:
                                    Align: ='TextCanvas.Align'.End
                                    Height: =Parent.TemplateHeight
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =4
                                    Size: =10
                                    Text: =$"{Text(ThisItem.EventDate,"HH:mm")}"
                                    VerticalAlign: =VerticalAlign.Top
                                    Width: =If(Parent.TemplateWidth*0.25 >28,Parent.TemplateWidth*0.25,28)
                                    X: =Parent.TemplateWidth-Self.Width
                                    Y: |+
                                      =0
                        - txtDayDate:
                            Control: Text@0.0.51
                            Properties:
                              FontColor: |-
                                =If(ThisItem.Value >= Date(
                                    Year(varMonth),
                                    Month(varMonth)+1,
                                    1
                                    ) || ThisItem.Value <= Date(
                                    Year(varMonth),
                                    Month(varMonth),
                                    0
                                    )
                                    || Weekday(ThisItem.Value) = 1
                                    || Weekday(ThisItem.Value) = 7
                                    ,RGBA(116,116,116,1),RGBA(00,0,0,1)
                                )
                              Height: =Parent.TemplateHeight *0.2
                              PaddingLeft: =3
                              Size: =12
                              Text: =$"{Text(ThisItem.Value,"dd")}"
                              Width: =Parent.TemplateWidth
                              Wrap: =false
                        - btnSelectDate:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(0,0,0,0)
                              BorderThickness: =0
                              Color: =RGBA(0,0,0,0)
                              DisabledBorderColor: =RGBA(0,0,0,0)
                              DisplayMode: |-
                                =If(ThisItem.Value >= Date(
                                    Year(varMonth),
                                    Month(varMonth)+1,
                                    1
                                    ) || ThisItem.Value <= Date(
                                    Year(varMonth),
                                    Month(varMonth),
                                    0
                                    ),DisplayMode.Disabled,DisplayMode.Edit
                                )
                              Fill: =RGBA(0,0,0,0)
                              FocusedBorderColor: =RGBA(0,0,0,0)
                              FocusedBorderThickness: =0
                              Font: =Font.'Open Sans'
                              Height: =Parent.TemplateHeight
                              HoverBorderColor: =RGBA(0,0,0,0)
                              HoverColor: =RGBA(0,0,0,0)
                              HoverFill: =RGBA(240, 232, 245, 0.4)
                              OnSelect: =Select(Parent)
                              PressedBorderColor: =RGBA(0,0,0,0)
                              PressedColor: =RGBA(0,0,0,0)
                              PressedFill: =RGBA(0,0,0,0)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Text: =""
                              Visible: |-
                                =// If this day lands on a work day in the selected month, be visible, if not visible=false 

                                If(ThisItem.Value >= Date(
                                    Year(varMonth),
                                    Month(varMonth)+1,
                                    1
                                    ) || ThisItem.Value <= Date(
                                    Year(varMonth),
                                    Month(varMonth),
                                    0
                                    )
                                    || Weekday(ThisItem.Value) = 1
                                    || Weekday(ThisItem.Value) = 7
                                    ,false,true
                                )
                              Width: =Parent.TemplateWidth
